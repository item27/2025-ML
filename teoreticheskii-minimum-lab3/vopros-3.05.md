# Вопрос №3.05

> Метрики качества кластеризации: внутри- и межкластерное расстояния, силуэт

Вкратце — формулы, смысл и как интерпретировать.

## Внутрикластерное расстояние (Within-Cluster Sum of Squares, WSS)

Определение:

$$
WSS=\sum_{i=1}^{k}\sum_{x\in C_i}|x-\mu_i|^2,
$$

где $$\mu_i$$ — центр (среднее) кластера $$C_i$$. Смысл: суммарная дисперсия точек внутри кластеров. Интерпретация: меньше — лучше (более компактные кластеры). Замечания:

* При росте $$k$$ $$WSS$$ монотонно уменьшается. Поэтому используют график «локоть» (elbow) для выбора $$k$$.
* Чувствителен к масштабу признаков. Нормализуйте данные перед расчётом.
* Быстрый расчёт при известных центрах: $$O(n d)$$ на итерацию (n — число точек, d — размерность).

## Межкластерное расстояние / между-кластерная дисперсия (BSS)

Определение через центры и общий центр $$\mu$$:

$$
BSS=\sum_{i=1}^{k}|C_i||\mu_i-\mu|^2,
\qquad
\mu=\frac{1}{n}\sum_{x}x.
$$

Смысл: насколько центры кластеров удалены от общего центра. Интерпретация: больше — лучше (кластеры хорошо отделены друг от друга). Связь с общей дисперсией:

$$
TSS = \sum_x |x-\mu|^2 = WSS + BSS.
$$

Отсюда доля объяснённой вариации:

$$
\text{explained} = \frac{BSS}{TSS}.
$$

Чем ближе к 1, тем сильнее структура по отношению к общей вариативности.

## Силуэт (silhouette)

Для точки $$i$$:

* $$a(i)$$ — среднее расстояние от $$i$$ до всех точек своего кластера.
*   Для каждого другого кластера вычислить среднее расстояние от $$i$$ до точек этого кластера. Обозначим минимальное такое значение как $$b(i)$$. Силуэт точки:

    $$
    s(i)=\frac{b(i)-a(i)}{\max(a(i),b(i))}.
    $$

    Свойства:
* $$s(i)\in[-1,1]$$.
* $$s(i)\approx 1$$ — точка хорошо кластеризована.
* $$s(i)\approx 0$$ — точка на границе кластеров.
*   $$s(i)<0$$ — точка, вероятно, ошибочно отнесена к своему кластеру. Агрегатная метрика: средний силуэт по всем точкам

    $$
    \bar{s}=\frac{1}{n}\sum_{i=1}^n s(i).
    $$

    Практическая интерпретация для $$\bar{s}$$:
* $$\bar{s}>0.5$$ — хорошая структура.
* $$0.25<\bar{s}\le 0.5$$ — слабая, но допустимая структура.
* $$\bar{s}\le 0.25$$ — малозаметная структура или её нет. Замечания:
* Вычислительно требовательна: наивная оценка требует попарных расстояний $$O(n^2 d)$$. Для больших наборов применяют приближения или выборки.

## Что сравнивать и когда

* Для оценки компактности смотреть $$WSS$$. Сравнивать при одинаковом масштабировании и фиксированном $$k$$.
* Для оценки разделимости смотреть $$BSS$$ или долю $$BSS/TSS$$.
* Для баланса компактности и разделимости смотреть силуэт $$\bar{s}$$.
* Для выбора $$k$$ обычно используют: elbow по $$WSS$$ + проверка $$\bar{s}$$ (максимум) и визуализация.

## Практические советы

1. Всегда масштабируйте признаки.
2. Сравнивайте метрики в совокупности. Один показатель может вводить в заблуждение.
3. Для больших данных используйте приближённые методы для силуэта или вычисляйте силуэт на подвыборке.
4. Если кластеры разной плотности, силуэт и WSS могут быть малоинформативны. Рассмотрите HDBSCAN и другие индексы.

## Короткая шпаргалка для сдачи

* $$WSS=\sum_{i}\sum_{x\in C_i}|x-\mu_i|^2$$ — чем меньше, тем лучше (компактность).
* $$BSS=\sum_{i}|C_i||\mu_i-\mu|^2$$, $$TSS=WSS+BSS$$, $$BSS/TSS$$ — доля объяснённой дисперсии.
* $$s(i)=\dfrac{b(i)-a(i)}{\max(a(i),b(i))}$$, $$\bar{s}$$ в среднем: >0.5 хорошая, <0.25 плохая.

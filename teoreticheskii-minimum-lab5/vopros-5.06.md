# Вопрос №5.06

> 2d pooling. Как работает, обучается ли слой, зачем нужен, какие гиперпараметры и на что влияют

### 2D Pooling: как работает

2D pooling (чаще MaxPool2D или AvgPool2D) — операция, которая **уменьшает пространственный размер** карт признаков $$H \times W$$, агрегируя значения в небольших окнах.

Вход: $$H \times W \times C$$ Выход: $$H' \times W' \times C$$ (число каналов $$C$$ обычно не меняется)

#### MaxPool2D

Берём окно $$K \times K$$ и заменяем его одним числом — максимумом:

$$
y(i,j,c) = \max_{(u,v)\in \text{окне}} x(\dots, c)
$$

#### AvgPool2D

То же окно, но берём среднее:

$$
y(i,j,c) = \frac{1}{K^2}\sum_{(u,v)\in \text{окне}} x(\dots, c)
$$

***

### Обучается ли pooling-слой

Нет, у pooling **нет обучаемых параметров** (весов и bias). Он “фиксированно” берёт максимум или среднее.

Но через него всё равно идёт backprop:

* MaxPool: градиент проходит только туда, где был максимум в окне
* AvgPool: градиент распределяется равномерно по элементам окна

***

### Зачем нужен pooling

1. **Уменьшает размер** $$H \times W$$ → меньше вычислений и памяти дальше по сети.
2. **Увеличивает рецептивное поле** следующих слоёв: один элемент после pooling “покрывает” большую область исходного изображения.
3. **Стабильность к небольшим сдвигам**: если признак чуть сместился, максимум в окне часто остаётся тем же.
4. **Регуляризация**: сжатие может уменьшить переобучение (меньше деталей, меньше “шума”).

На практике иногда вместо pooling используют свёртку со stride $$S>1$$ (тоже downsampling), но pooling — классический и простой вариант.

***

### Гиперпараметры и на что влияют

| Гиперпараметр                                | Что это                        | Влияние                                                                                       |
| -------------------------------------------- | ------------------------------ | --------------------------------------------------------------------------------------------- |
| Тип pooling                                  | max или average                | max выделяет “самый сильный” отклик признака; avg сглаживает и сохраняет “среднюю” активность |
| Размер окна $$K_h \times K_w$$ (kernel size) | размер области агрегации       | больше окно → сильнее сжатие/потеря деталей, больше инвариантность                            |
| Stride $$S$$                                 | шаг окна                       | основной контроль уменьшения размеров: чаще $$S=K$$                                           |
| Padding $$P$$                                | доп. рамка                     | влияет на то, обрабатываются ли края и какой будет размер выхода                              |
| Ceil/Floor mode (в некоторых фреймворках)    | округление при расчёте размера | влияет на точный $$H',W'$$, когда размер не делится ровно                                     |

Размер выхода по высоте (аналогично для ширины):

$$
H' = \left\lfloor \frac{H + 2P - K_h}{S} + 1 \right\rfloor
$$

***

### Типичные настройки

* MaxPool2D с $$K=2, S=2$$: уменьшает $$H$$ и $$W$$ примерно в 2 раза.
* AvgPool2D часто используют ближе к концу (например, GlobalAvgPool).

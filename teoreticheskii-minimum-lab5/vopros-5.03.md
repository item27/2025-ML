# Вопрос №5.03

> Как свёртка меняет размер изображения

Пусть вход имеет размер $$H \times W$$ (для простоты без каналов). После свёртки получаем размер $$H' \times W'$$.

Размер **уменьшается**, потому что фильтр (ядро) должен “поместиться” в изображение: когда мы двигаем окно $$K \times K$$ по входу, для краёв может не хватать пикселей.

***

### От каких параметров зависит уменьшение

На размер выхода влияют:

* размер ядра $$K$$ (или $$K_h, K_w$$)
* шаг $$S$$ (stride)
* паддинг $$P$$ (padding)
* дилатация $$D$$ (dilation, если есть)

Формула для высоты:

$$
H' = \left\lfloor \frac{H + 2P - D\cdot (K-1) - 1}{S} + 1 \right\rfloor
$$

Аналогично для ширины:

$$
W' = \left\lfloor \frac{W + 2P - D\cdot (K-1) - 1}{S} + 1 \right\rfloor
$$

Если $$D=1$$ (самый частый случай), то:

$$
H' = \left\lfloor \frac{H + 2P - K}{S} + 1 \right\rfloor
$$

**Что делает изображение меньше сильнее всего:**

* большой $$K$$ → сильнее “съедает” края
* большой $$S$$ → сильнее сжимает (downsampling)
* маленький $$P$$ → сильнее уменьшает (особенно при $$P=0$$)

***

### Что такое stride

**Stride** $$S$$ — это шаг, с которым мы двигаем окно свёртки.

* $$S=1$$: фильтр проходит по всем соседним позициям → выход почти такой же по размеру (если есть padding).
* $$S=2$$: фильтр “перепрыгивает” через пиксели → размер по каждой оси примерно в 2 раза меньше.

Пример: если $$H=28$$, $$K=3$$, $$P=1$$:

* $$S=1$$ → $$H' = 28$$
* $$S=2$$ → $$H' = 14$$

***

### Что такое padding

**Padding** $$P$$ — это добавление рамки вокруг изображения (обычно нулями), чтобы:

* не терять информацию на границах,
* контролировать размер выхода.

Основные режимы:

#### Valid (без паддинга)

$$P = 0$$ Тогда размер уменьшается:

$$$
H' = H - K + 1 \quad \text{(если $$S=1$$)}
$$$

Пример: $$28 \to 26$$ при $$K=3$$.

#### Same (сохранить размер)

Подбирают $$P$$ так, чтобы при $$S=1$$ было $$H'=H$$. Для нечётного $$K$$ (например, $$3,5,7$$) обычно:

$$
P = \frac{K-1}{2}
$$

Пример: $$K=3 \Rightarrow P=1$$, тогда $$28 \to 28$$.

***

### Короткий вывод: “насколько станет меньше”

Если упрощённо (без дилатации) и примерно:

* При $$S=1$$:
  * без padding: уменьшается на $$K-1$$
  * с same padding: почти не меняется
* При $$S>1$$:
  * размер примерно делится на $$S$$ (с поправкой на $$K$$ и $$P$$)

***

### Мини-пример (как в визуализациях)

Вход: $$H=7$$, ядро $$K=3$$.

*   $$P=0, S=1$$:

    $$
    H' = 7 - 3 + 1 = 5
    $$
*   $$P=1, S=1$$:

    $$
    H' = 7 + 2\cdot 1 - 3 + 1 = 7
    $$
*   $$P=1, S=2$$:

    $$
    H' = \left\lfloor \frac{7 + 2 - 3}{2} + 1 \right\rfloor = 4
    $$

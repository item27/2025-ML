# Вопрос №5.04

> Карта признаков (feature map)

Карта признаков — это **выход одного фильтра** свёрточного слоя. Если слой применяет $$N$$ фильтров, то он выдаёт $$N$$ карт признаков.

Обычно тензор выхода свёртки имеет форму $$H' \times W' \times N$$:

* $$H', W'$$ — пространственные размеры карты
* $$N$$ — число карт признаков (каналов)

***

### Как рассчитывается карта признаков

Пусть вход $$x$$ имеет размер $$H \times W \times C$$. Один фильтр $$w$$ имеет размер $$K_h \times K_w \times C$$ (по глубине совпадает с $$C$$).

Тогда значение карты признаков в точке $$(i, j)$$:

$$
y(i,j) = \sum_{u=0}^{K_h-1}\sum_{v=0}^{K_w-1}\sum_{c=0}^{C-1} x(i+u, j+v, c), w(u,v,c) + b
$$

Интуитивно: это “насколько похоже” локальное окно изображения на шаблон, который выучил фильтр.

После этого часто применяют активацию (например ReLU), и итоговая карта хранит уже “активности” признака.

***

### Является ли feature map слоем

Нет. **Feature map — это данные (активации), а не слой.**

* **Слой** — это операция с параметрами (conv + bias + возможно BatchNorm/activation).
* **Карта признаков** — это результат работы слоя: один “канал” его выхода.

Иногда по привычке говорят “слой признаков”, но строго: слой выдаёт набор feature maps.

***

### Какие признаки хранят карты на разных глубинах сети

Общий принцип: чем глубже слой, тем **сложнее и более “собранные”** признаки.

#### Ранние слои

Карта признаков часто отвечает за:

* границы (вертикальные/горизонтальные/диагональные)
* простые контрасты
* мелкие текстуры, точки, углы

То есть “детекторы простых паттернов”.

#### Средние слои

Карты начинают реагировать на:

* комбинации границ → формы
* повторяющиеся текстуры
* части объектов (дуги, элементы одежды, фрагменты цифр)

#### Глубокие слои

Карты становятся более “семантическими”:

* “похоже на подошву”, “похоже на рукав”
* “характерный фрагмент класса”
* сочетания частей в целое

Важно: это не жёсткое правило (зависит от архитектуры и данных), но как модель объяснения работает почти всегда.

***

### Разное ли количество карт признаков в разных слоях

Да, обычно **разное**.

Количество карт признаков в слое = **число фильтров** $$N$$ (out\_channels). Это гиперпараметр архитектуры.

Типичный дизайн CNN:

* ближе к входу: меньше каналов (например $$32, 64$$)
* глубже: больше каналов (например $$128, 256, 512$$)

**Почему так делают:**

* по мере уменьшения $$H' \times W'$$ (из-за stride/pooling) можно позволить больше каналов
* глубоким слоям нужно больше “места”, чтобы кодировать сложные признаки

Пример (условно):

* вход: $$224 \times 224 \times 3$$
* после первых блоков: $$112 \times 112 \times 64$$
* дальше: $$56 \times 56 \times 128$$
* глубже: $$28 \times 28 \times 256$$
* ещё глубже: $$14 \times 14 \times 512$$

